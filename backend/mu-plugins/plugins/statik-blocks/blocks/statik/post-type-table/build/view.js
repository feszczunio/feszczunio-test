var StatikPostTypeTableBlock;!function(){"use strict";var t={n:function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,{a:r}),r},d:function(e,r){for(var s in r)t.o(r,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:r[s]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e={};t.d(e,{default:function(){return c}});var r=window.wp.apiFetch,s=t.n(r);class a{constructor(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.model=t,this.view=e,this.attributes=r.attributes,this.restBase=r.restBase,this.currentPostId=r.currentPostId}async init(){let t;try{t=await this.fetchPosts()}catch(t){return console.error("There was a problem with the fetch operation:",t),this.view.empty(),void this.view.renderError("Sorry, something went wrong. Please try again later.")}this.handleAddPosts(t),this.view.empty(),this.view.renderTable(),this.view.renderTableHeadRow(this.model.posts),this.view.renderRows(this.model.posts)}async fetchPosts(){const t=this.attributes.query,e=t.exclude?[].concat(t.exclude):[];this.attributes.excludeCurrentPost&&e.push(this.currentPostId);const r={...t,exclude:e.length?e:""},a=new URLSearchParams(r).toString();return await s()({path:`/wp/v2/${this.restBase}?_embed&${a}`})}handleAddPosts(t){t.forEach((t=>{this.model.addPost(t,this.attributes)}))}}class o{constructor(t,e){this.post=t,this.attributes=e}get followUpArea(){return this.attributes.followUpArea}get link(){return this._getUrlHref()}get displayCategories(){return this.attributes.displayCategories}get categories(){return this._getTaxonomyTerms("categories")}get displayDate(){return this.attributes.displayLastUpdatedDate}get dateTime(){return this._getDayYYYYMMDD(this.post.modified_gmt)}get displayTitle(){return this.attributes.displayTitle}get title(){return this.post.title.rendered}get displayTags(){return this.attributes.displayCategories}get tags(){return this._getTaxonomyTerms("tags")}get displayReadMoreButton(){return this.attributes.displayReadMoreButton}_getDayYYYYMMDD(t){const e=new Date(t);return new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().split("T")[0]}_getTaxonomyTerms(t){var e,r;const s=null!==(e=this.post[t])&&void 0!==e?e:[];return(null!==(r=this.post._embedded?.["wp:term"]?.flat())&&void 0!==r?r:[]).filter((t=>s.includes(t.id)))}_getUrlHref(){const{destination:t}=this.attributes;if("default"===t)return this.post.link;const e=t;return this._getObjectPropertyByPath(this.post,e)}_getObjectPropertyByPath(t,e){const r=e.split(".").map((t=>this._convertCamelToSnake(t)));let s=t;for(const t of r){if(!s.hasOwnProperty(t)){s=void 0,console.error(`The provided path '${e}' cannot be resolved`);break}s=s[t]}return s}_convertCamelToSnake(t){return t.replace(/[A-Z]/g,((t,e)=>(0===e?"":"_")+t.toLowerCase()))}}class i{posts=[];addPost(t,e){this.posts.push(new o(t,e))}}class n{static render(t){const e=document.createElement("template");return e.innerHTML=this.renderRow(t),e.content.firstElementChild}static renderRow(t){const e=["wp-block-statik-post-type-table__card"];return"area"===t.followUpArea&&e.push("wp-block-statik-post-type-table__row--clickable"),[`<tr class="${e.join(" ")}">`,this.renderContentHtml(t),"</tr>"].join("")}static renderContentHtml(t){return[this.renderTitleHtml(t),this.renderCategoriesHtml(t),this.renderTagsHtml(t),this.renderDateHtml(t),this.renderReadMoreButtonHtml(t)].join("")}static renderTitleHtml(t){if(t.displayTitle)return['<td class="wp-block-statik-post-type-table__title">',`<h3>${t.title}</h3>`,"</td>"].join("")}static renderCategoriesHtml(t){if(t.displayCategories)return['<td class="wp-block-statik-post-type-table__categories">',"<ul>",t.categories.map((t=>`<li>${t.name}</li>`)).join(""),"</ul>","</td>"].join("")}static renderTagsHtml(t){if(t.displayTags)return['<td class="wp-block-statik-post-type-table__tags">',"<ul>",t.tags.map((t=>`<li>${t.name}</li>`)).join(""),"</ul>","</td>"].join("")}static renderDateHtml(t){if(t.displayDate)return['<td class="wp-block-statik-post-type-table__updated" >',`<time datetime="${t.dateTime}">`,t.dateTime,"</time>","</td>"].join("")}static renderReadMoreButtonHtml(t){if(t.displayReadMoreButton){if("none"===t.followUpArea||"area"===t.followUpArea)return['<td class="wp-block-statik-post-type-table__read-more">',"Read More","</td>"].join("");if("button"===t.followUpArea)return['<td class="wp-block-statik-post-type-table__read-more">',`<a href="${t.link}">`,"Read More","</a>","</td>"].join("");throw new Error(`Unsupported 'followUpArea' value: ${t.followUpArea}`)}}}class l{static render(t){const e=document.createElement("template");return e.innerHTML=this.renderRow(t),e.content.firstElementChild}static renderRow(t){return['<tr class="wp-block-statik-post-type-table__header-row">',this.renderContentHtml(t),"</tr>"].join("")}static renderContentHtml(t){return[this.renderTitleHtml(t),this.renderCategoriesHtml(t),this.renderTagsHtml(t),this.renderDateHtml(t),this.renderReadMoreButtonHtml(t)].join("")}static renderTitleHtml(t){if(t.displayTitle)return['<th class="wp-block-statik-post-type-table__title">',"Title","</th>"].join("")}static renderCategoriesHtml(t){if(t.displayCategories)return['<th class="wp-block-statik-post-type-table__categories">',"Categories","</th>"].join("")}static renderTagsHtml(t){if(t.displayTags)return['<th class="wp-block-statik-post-type-table__tags">',"Tags","</th>"].join("")}static renderDateHtml(t){if(t.displayDate)return['<th class="wp-block-statik-post-type-table__updated">',"Date","</th>"].join("")}static renderReadMoreButtonHtml(t){if(t.displayReadMoreButton)return['<th class="wp-block-statik-post-type-table__read-more">',"Read More","</th>"].join("")}}class d{constructor(t){this.rootElement=document.querySelector(t)}empty(){this.rootElement.innerHTML=""}renderTable(){const t=document.createElement("table");t.innerHTML=["<thead>","</thead>","<tbody>","</tbody>"].join(""),this.rootElement.append(t)}renderTableHeadRow(t){const e=this.rootElement.querySelector("table").querySelector("thead"),r=l.render(t[0]);e.append(r)}renderRows(t){const e=this.rootElement.querySelector("table").querySelector("tbody"),r=t.map((t=>{const e=n.render(t);return this.bindTableRowEffects(e,t),e}));e.append(...r)}renderError(t){const e=document.createElement("template");e.innerHTML=['<div class="wp-block-statik-post-type-cards__error">',t,"</div>"].join(""),this.rootElement.append(e.content)}bindTableRowEffects(t,e){"area"===e.followUpArea&&t.addEventListener("click",(()=>{window.location.href=e.link}))}}function c(t){let{attributes:e,restBase:r,currentPostId:s}=t;document.addEventListener("DOMContentLoaded",(async()=>{const t=new a(new i,new d(`.wp-block-${e.blockId}`),{attributes:e,restBase:r,currentPostId:s});await t.init()}))}StatikPostTypeTableBlock=e.default}();