var StatikVideoCardsBlock;!function(){"use strict";var t={n:function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,{a:i}),i},d:function(e,i){for(var a in i)t.o(i,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:i[a]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e={};t.d(e,{default:function(){return o}});var i=window.wp.apiFetch,a=t.n(i),n=window.statik.utils;function o(t){let{attributes:e}=t;document.addEventListener("DOMContentLoaded",(async()=>{const t=new r(document.querySelector(`.wp-block-${e.blockId}`),e);await t.init()}))}class r{constructor(t,e){this.element=t,this.attributes=e,this.modalContainerElement=null,this.posts=null,this.videos=null}async init(){await this.prepareData(),await this.renderPosts()}async prepareData(){this.posts||(this.posts=await this.fetchPosts()),this.videos||(this.videos=await this.fetchVideos(this.posts),this.posts.forEach((t=>{const{video_source:e,local_file:i}=t.acf;if("local"===e){var a;const e=this.videos.find((t=>t.id===i));t.acf.video_url=null!==(a=e?.guid?.rendered)&&void 0!==a?a:null}})))}async fetchPosts(){let t=[];const e=new URLSearchParams(this.attributes.query).toString();try{t=await a()({path:`/wp/v2/videos?_embed&${e}`})}catch(t){console.error("There was a problem with the fetch operation:",t)}return t}async fetchVideos(t){let e=[];const i=(await this.getVideosIds(t)).join(",");try{e=await a()({path:`/wp/v2/media?_embed&include=${i}`})}catch(t){console.error("There was a problem with the fetch operation:",t)}return e}async getVideosIds(t){const e=[];return t.forEach((t=>{const{video_source:i,local_file:a}=t.acf;"local"===i&&e.push(a)})),e}getPostTagName(){return"area"===this.attributes.followUpArea?"a":"div"}async renderPosts(){const t=await Promise.all(this.posts.map((async t=>await this.getVideoCardHtml(t)))),e=this.getStyle(),i=document.createDocumentFragment();t.forEach(((t,e)=>{const a=this.posts[e];i.appendChild(t),this.registerEffects(t,a)})),this.element.appendChild(i),this.element.appendChild(e)}async getVideoCardHtml(t){const e=this.getPostTagName(),i=this.getUrlHref(t),{followUpArea:a,followUpBehaviour:n}=this.attributes,o=document.createElement(e);return o.setAttribute("class","wp-block-statik-video-cards__card"),"area"===a&&"redirect"===n&&o.setAttribute("href",i),o.innerHTML=`\n\t\t\t${this.getPostImageHtml(t)}\t\t\n\t\t\t${this.getPostCategoriesHtml(t)}\n\t\t\t${this.getPostDateHtml(t)}\n\t\t\t${this.getPostTitleHtml(t)}\n\t\t\t${this.getPostExcerptHtml(t)}\n\t\t\t${this.getPostTagsHtml(t)}\n\t\t\t${this.getReadMoreButtonHtml(t)}\n\t\t\t${this.getPlayButtonHtml()}\n\t\t`,o}getPostTitleHtml(t){return this.attributes.displayTitle?`<h3>${t.title.rendered}</h3>`:""}getSrcsetAttribute(t){const e=[],i=Object.entries(t);for(const[,t]of i)e.push(`${t.source_url} ${t.width}w`);return e.join(", ")}getPostImageHtml(t){if(!this.attributes.displayFeaturedImage)return"";const e=t?._embedded?.["wp:featuredmedia"];if(!e)return'\n\t\t\t\t<div class="wp-block-statik-video-cards__image--empty"></div>\n\t\t\t';const{source_url:i,title:a,media_details:n}=e[0];return`\n\t\t\t<div class="wp-block-statik-video-cards__image">\n\t\t\t\t<img srcset="${this.getSrcsetAttribute(n.sizes)}" \n\t\t\t\t\t src="${i}" \n\t\t\t\t\t alt="${a.rendered}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`}getTaxonomyTerms(t,e){var i,a;const n=null!==(i=t[e])&&void 0!==i?i:[];return(null!==(a=t._embedded?.["wp:term"]?.flat())&&void 0!==a?a:[]).filter((t=>n.includes(t.id))).map((t=>t.name))}getPostCategoriesHtml(t){return this.attributes.displayCategories?`\n\t\t<ul class="wp-block-statik-video-cards__categories">\n\t\t\t${this.getTaxonomyTerms(t,"videos_category").map((t=>`<li>${t}</li>`)).join("")}\n\t\t</ul>\n\t\t`:""}getPostTagsHtml(t){return this.attributes.displayTags?`\n\t\t  <ul class="wp-block-statik-video-cards__tags">\n\t\t\t${this.getTaxonomyTerms(t,"videos_tag").map((t=>`<li>${t}</li>`)).join("")}\n\t\t  </ul>\n\t\t`:""}getPostExcerptHtml(t){return this.attributes.displayExcerpt?`\n\t\t<div\n\t\tclass="wp-block-statik-video-cards__excerpt">\n\t\t\t${t.excerpt.rendered}\n\t\t</div>\n\t\t`:""}getDayYYYYMMDD(t){const e=new Date(t);return new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().split("T")[0]}getPostDateHtml(t){if(!this.attributes.displayLastUpdatedDate)return"";const e=this.getDayYYYYMMDD(t.modified_gmt);return`\n\t\t<time class="wp-block-statik-video-cards__updated" datetime=${e}>\n\t\t\t${e}\n\t\t</time>\n\t\t`}convertCamelToSnake(t){return t.replace(/[A-Z]/g,((t,e)=>(0===e?"":"_")+t.toLowerCase()))}getObjectPropertyByPath(t,e){const i=e.split(".").map((t=>this.convertCamelToSnake(t)));let a=t;for(const t of i){if(!a.hasOwnProperty(t)){a=void 0,console.error(`The provided path '${e}' cannot be resolved`);break}a=a[t]}return a}getUrlHref(t){const{destination:e}=this.attributes;if("default"===e)return t.link;const i=e;return this.getObjectPropertyByPath(t,i)}getReadMoreButtonHtml(t){if(!this.attributes.displayReadMoreButton)return"";const{followUpArea:e}=this.attributes;return"none"===e||"area"===e?' \n\t\t\t\t<div class="wp-block-statik-video-cards__read-more" >\n\t\t\t\t\tRead More\n\t\t\t\t</div>\n\t\t\t':`\n\t\t\t<a class="wp-block-statik-video-cards__read-more" href="${this.getUrlHref(t)}">\n\t\t\t\tRead More\n\t\t\t</a>\n\t\t`}getPlayButtonHtml(){return this.attributes.displayPlayButton?'\n\t\t<button class="wp-block-statik-video-cards__play-button">\n\t\t\t<svg\n\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\twidth="32"\n\t\t\t\theight="32"\n\t\t\t\tviewBox="0 0 32 32"\n\t\t\t>\n\t\t\t\t<path\n\t\t\t\tfill="fill"\n\t\t\t\td="M16 0C7.163 0 0 7.163 0 16s7.163 16 16 16 16-7.163 16-16S24.837 0 16 0zm0 29C8.82 29 3 23.18 3 16S8.82 3 16 \t3s13 5.82 13 13-5.82 13-13 13zM12 9l12 7-12 7z"\n\t\t\t/>\n\t\t\t</svg>\n\t\t</button>\n\t\t':""}registerEffects(t,e){const{followUpBehaviour:i,followUpArea:a}=this.attributes;if("redirect"===i)return null;let n=null;return"area"===a&&"modal"===i&&(n=t),"button"===a&&"modal"===i&&(n=t.querySelector(".wp-block-statik-video-cards__read-more")),n&&n.addEventListener("click",(async t=>{t.preventDefault(),await this.appendModal(e),this.openModal(e)})),n}async appendModal(t){if(this.modalContainerElement)return;const e=await this.getModalHtml(t),i=document.createElement("template");i.innerHTML=e.trim(),this.modalContainerElement=i.content.firstChild,document.body.appendChild(this.modalContainerElement)}openModal(t){const e=this.getModalConfig();n.MicroModal.show(`modal-video-card-${t.id}`,e)}destroyModal(){this.modalContainerElement&&(this.modalContainerElement.remove(),this.modalContainerElement=null)}getExternalVideoModalHtml(t){return`\n\t\t<iframe width="560" height="315" src="${t}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>\n\t\t`}getInternalVideoModalHtml(t){return`\n\t\t<video width="560" height="315" controls>\n\t\t<source src="${t}" type="video/mp4">\n\t\tYour browser does not support the video tag.\n\t \t </video>`}async getModalHtml(t){const{video_source:e,video_url:i}=t.acf;let a=null;return"external"===e&&(a=this.getExternalVideoModalHtml(i)),"local"===e&&(a=this.getInternalVideoModalHtml(i)),`\n\t\t<div id="modal-video-card-${t.id}" class="modal micromodal-slide" aria-hidden="true">\n\t\t\t<div class="modal__overlay">\n\t\t\t\t<div class="modal__content"> \n\t\t\t\t\t<button class="modal__close" aria-label="Close modal" data-micromodal-close></button> \n\t\t\t\t ${a}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t`}getModalConfig(){return{disableScroll:!0,awaitCloseAnimation:!0,onClose:t=>{const e=this;t.addEventListener("animationend",(function i(){e.destroyModal(),t.removeEventListener("animationend",i,!1)}),!1)}}}getStyle(){const t=(0,n.rwdAttribute)(this.attributes.cardsPerRow),e=document.createElement("style");return e.innerHTML=`\n\t\t.wp-block-${this.attributes.blockId} {\n\t\t  --wp-block-statik-video-cards--attr--cardsPerRow: ${t.inherit.mobile};\n\t\t}\n\t\t@media (min-width: 991px) {\n\t\t  .wp-block-${this.attributes.blockId} {\n\t\t\t--wp-block-statik-video-cards--attr--cardsPerRow: ${t.inherit.tablet};\n\t\t  }\n\t\t}\n\t\t@media (min-width: 1200px) {\n\t\t  .wp-block-${this.attributes.blockId} {\n\t\t\t--wp-block-statik-video-cards--attr--cardsPerRow: ${t.inherit.desktop};\n\t\t  }\n\t\t}\n\t\t`,e}}StatikVideoCardsBlock=e.default}();